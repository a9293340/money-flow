# Personal Finance Manager - Server API

é€™æ˜¯ Personal Finance Manager çš„ Nuxt.js 3 Server API å¯¦ä½œã€‚

## ğŸ—ï¸ å·²é…ç½®çš„å…ƒä»¶

### ğŸ“¦ è³‡æ–™åº«å±¤
- **MongoDB Atlas é€£æ¥**: ä½¿ç”¨ Mongoose ODM
- **æ¨¡å‹å®šç¾©**: User, Category, Record, Budget, ExchangeRate
- **ç´¢å¼•å„ªåŒ–**: æŸ¥è©¢æ•ˆèƒ½æœ€ä½³åŒ–
- **é€£æ¥ç®¡ç†**: è‡ªå‹•é‡é€£å’ŒéŒ¯èª¤è™•ç†

### ğŸ› ï¸ ä¼ºæœå™¨è¨­å®š
- **ç’°å¢ƒè®Šæ•¸ç®¡ç†**: å®Œæ•´çš„é…ç½®é©—è­‰å’Œé¡å‹å®‰å…¨
- **ä¸­ä»‹è»Ÿé«”**: è‡ªå‹•è³‡æ–™åº«é€£æ¥æª¢æŸ¥
- **å¥åº·æª¢æŸ¥**: è³‡æ–™åº«å’Œç’°å¢ƒç‹€æ…‹ç›£æ§
- **éŒ¯èª¤è™•ç†**: çµ±ä¸€çš„éŒ¯èª¤å›æ‡‰æ ¼å¼

## ğŸ“ æª”æ¡ˆçµæ§‹

```
server/
â”œâ”€â”€ api/                      # API ç«¯é»
â”‚   â”œâ”€â”€ health/              
â”‚   â”‚   â”œâ”€â”€ database.get.ts   # è³‡æ–™åº«å¥åº·æª¢æŸ¥
â”‚   â”‚   â””â”€â”€ env.get.ts        # ç’°å¢ƒè®Šæ•¸æª¢æŸ¥
â”‚   â””â”€â”€ database/
â”‚       â””â”€â”€ seed.post.ts      # è³‡æ–™ç¨®å­ API
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ database.ts           # è³‡æ–™åº«é€£æ¥ä¸­ä»‹è»Ÿé«”
â”œâ”€â”€ models/                   # Mongoose æ¨¡å‹
â”‚   â”œâ”€â”€ User.ts              # ä½¿ç”¨è€…æ¨¡å‹
â”‚   â”œâ”€â”€ Category.ts          # åˆ†é¡æ¨¡å‹
â”‚   â”œâ”€â”€ Record.ts            # äº¤æ˜“è¨˜éŒ„æ¨¡å‹
â”‚   â”œâ”€â”€ Budget.ts            # é ç®—æ¨¡å‹
â”‚   â”œâ”€â”€ ExchangeRate.ts      # åŒ¯ç‡æ¨¡å‹
â”‚   â””â”€â”€ index.ts             # æ¨¡å‹åŒ¯å‡º
â””â”€â”€ utils/                   # å·¥å…·å‡½æ•¸
    â”œâ”€â”€ database.ts          # è³‡æ–™åº«é€£æ¥ç®¡ç†
    â””â”€â”€ env.ts               # ç’°å¢ƒè®Šæ•¸å·¥å…·
```

## ğŸš€ é–‹å§‹ä½¿ç”¨

### 1. ç’°å¢ƒè®Šæ•¸è¨­å®š
è¤‡è£½ `.env.example` åˆ° `.env` ä¸¦å¡«å…¥å¯¦éš›å€¼ï¼š

```bash
cp .env.example .env
```

### 2. å¿…è¦ç’°å¢ƒè®Šæ•¸
```env
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/database
JWT_SECRET=your-secret-key
ENCRYPTION_KEY=32-byte-hex-string
```

### 3. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
```bash
yarn dev
```

### 4. å¥åº·æª¢æŸ¥
- è³‡æ–™åº«ç‹€æ…‹: `GET /api/health/database`
- ç’°å¢ƒè®Šæ•¸: `GET /api/health/env`

## ğŸ”§ API ç«¯é»

### å¥åº·æª¢æŸ¥
- **GET** `/api/health/database` - è³‡æ–™åº«é€£æ¥ç‹€æ…‹
- **GET** `/api/health/env` - ç’°å¢ƒè®Šæ•¸é…ç½®ç‹€æ…‹

### è³‡æ–™ç®¡ç†
- **POST** `/api/database/seed` - å»ºç«‹é è¨­åˆ†é¡
  ```json
  {
    "userId": "user_id_here"
  }
  ```

## ğŸ“Š è³‡æ–™æ¨¡å‹

### User (ä½¿ç”¨è€…)
- åŸºæœ¬è³‡è¨Šï¼šemail, password, name
- åå¥½è¨­å®šï¼šcurrency, theme, language
- ç³»çµ±æ¬„ä½ï¼šemailVerified, isActive

### Category (åˆ†é¡)  
- åˆ†é¡è³‡è¨Šï¼šname, type (income/expense), icon, color
- å±¤ç´šçµæ§‹ï¼šæ”¯æ´å­åˆ†é¡ (parentId)
- ä½¿ç”¨çµ±è¨ˆï¼šusageCount, lastUsedAt

### Record (äº¤æ˜“è¨˜éŒ„)
- äº¤æ˜“è³‡è¨Šï¼šamount, type, description, date
- å¤šå¹£åˆ¥ï¼šcurrency, exchangeRate, baseCurrencyAmount  
- é™„åŠ è³‡æ–™ï¼štags, location, receipt

### Budget (é ç®—)
- é ç®—è¨­å®šï¼šname, amount, period
- æ™‚é–“ç¯„åœï¼šstartDate, endDate
- è­¦å‘Šè¨­å®šï¼šwarningThreshold
- çµ±è¨ˆå¿«å–ï¼šcurrentSpent

### ExchangeRate (åŒ¯ç‡)
- åŒ¯ç‡è³‡è¨Šï¼šfromCurrency, toCurrency, rate
- è³‡æ–™ä¾†æºï¼šsource, fetchedAt

## ğŸ›¡ï¸ å®‰å…¨æ€§

- **JWT èªè­‰**: ä½¿ç”¨è€…èº«ä»½é©—è­‰
- **è³‡æ–™åŠ å¯†**: æ•æ„Ÿè³‡æ–™åŠ å¯†å„²å­˜
- **è¼¸å…¥é©—è­‰**: Zod schema é©—è­‰
- **ç´¢å¼•å„ªåŒ–**: é˜²æ­¢ N+1 æŸ¥è©¢å•é¡Œ

## ğŸ“ˆ ç›£æ§

- **é€£æ¥ç‹€æ…‹**: å³æ™‚è³‡æ–™åº«é€£æ¥ç›£æ§
- **æ¨¡å‹è¼‰å…¥**: ç¢ºä¿æ‰€æœ‰ Mongoose æ¨¡å‹æ­£ç¢ºè¼‰å…¥
- **ç’°å¢ƒé©—è­‰**: å•Ÿå‹•æ™‚æª¢æŸ¥å¿…è¦ç’°å¢ƒè®Šæ•¸

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **è³‡æ–™åº«é€£æ¥å¤±æ•—**
   - æª¢æŸ¥ `MONGODB_URI` ç’°å¢ƒè®Šæ•¸
   - ç¢ºèªç¶²è·¯é€£æ¥å’Œ MongoDB Atlas ç™½åå–®

2. **æ¨¡å‹è¼‰å…¥å¤±æ•—** 
   - æª¢æŸ¥ `/api/health/database` çš„ collections ç‹€æ…‹
   - ç¢ºèªæ¨¡å‹æ–‡ä»¶èªæ³•æ­£ç¢º

3. **ç’°å¢ƒè®Šæ•¸éŒ¯èª¤**
   - æŸ¥çœ‹ `/api/health/env` çš„éŒ¯èª¤è¨Šæ¯
   - ç¢ºèª `.env` æª”æ¡ˆå­˜åœ¨ä¸”æ ¼å¼æ­£ç¢º

### æ—¥èªŒæŸ¥çœ‹
é–‹ç™¼æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰é€£æ¥äº‹ä»¶å’ŒéŒ¯èª¤éƒ½æœƒè¼¸å‡ºåˆ° consoleã€‚

## ğŸƒâ€â™‚ï¸ ä¸‹ä¸€æ­¥

1. å¯¦ä½œèªè­‰ API (è¨»å†Šã€ç™»å…¥ã€ç™»å‡º)
2. å»ºç«‹ CRUD API ç«¯é»
3. æ–°å¢è³‡æ–™é©—è­‰ä¸­ä»‹è»Ÿé«”
4. å¯¦ä½œæª”æ¡ˆä¸Šå‚³åŠŸèƒ½
5. æ–°å¢å¿«å–å±¤ (Redis)

---

æ›´æ–°æ—¥æœŸ: 2025-01-09  
ç‰ˆæœ¬: 1.0.0